<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinkty Demo 1.0.0</title>
    <!-- 引入 Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入 Google 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #121212;
            color: #ffffff;
        }
        .card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            margin-bottom: 20px;
            color: #ffffff;
        }
        .btn-primary {
            background-color: #6f42c1;
            border-color: #6f42c1;
        }
        .progress {
            height: 20px;
        }
        .rejected-item {
            background-color: #c82333;
            padding: 5px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .form-check-label, .form-label {
            color: #ffffff;
        }
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
            word-break: break-word;
        }
        .slider-container label {
            font-weight: bold;
            margin-bottom: 0;
        }
        .slider-container input[type="range"] {
            width: 100%;
        }
        .slider-container span {
            display: inline-block;
            color: #ccc;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="mb-4 text-center">Kinkty Demo 1.0.0</h1>

    <div class="progress mb-4">
        <div id="progressBar" class="progress-bar" style="width: 10%;">步驟 1 / 6</div>
    </div>

    <div id="pageIntro" class="card p-4">
        <p>請交由主動方填答</p>
        <button class="btn btn-primary" onclick="confirmIntro()">確定</button>
    </div>

    <div id="page1" class="card p-4 d-none">
        <h2>主動方填答</h2>
        <p>請選擇您想實踐或新增的 BDSM 項目：</p>
        <div id="options"></div>
        <div class="input-group mt-3">
            <input type="text" class="form-control" id="newItem" placeholder="新增項目">
            <button class="btn btn-outline-light" onclick="addItem()">新增</button>
        </div>
        <button class="btn btn-primary mt-3" onclick="confirmSelection()">確認選擇</button>
    </div>

    <div id="activeLimits" class="card p-4 d-none">
        <h2>主動方硬底線</h2>
        <p>請輸入您的硬底線：</p>
        <input type="text" class="form-control" id="activeHardLimit">
        <button class="btn btn-primary mt-3" onclick="confirmActiveHardLimit()">確認</button>
    </div>

    <div id="page2Intro" class="card p-4 d-none">
        <p>請交由被動方填答</p>
        <button class="btn btn-primary" onclick="confirmPage2Intro()">確定</button>
    </div>

    <div id="page2" class="card p-4 d-none">
        <h2>被動方填答</h2>
        <p>請選擇各項目的允許程度（0-5）：</p>
        <div id="allowance"></div>
        <button class="btn btn-primary mt-3" onclick="confirmAllowance()">確認</button>
    </div>

    <div id="passiveLimits" class="card p-4 d-none">
        <h2>被動方硬底線</h2>
        <p>請輸入您的硬底線：</p>
        <input type="text" class="form-control" id="passiveHardLimit">
        <button class="btn btn-primary mt-3" onclick="confirmPassiveHardLimit()">確認</button>
    </div>

    <div id="page3" class="card p-4 d-none">
        <h2>最終結果</h2>
        <pre id="finalResult" class="text-white"></pre>
        <h4 id="rejectedTitle" class="text-danger d-none">以下是被拒絕的項目，絕對禁止實踐：</h4>
        <div id="rejectedItems"></div>
    </div>
</div>

<script>
    let items = ["SP屁股", "SP大腿", "TK", "碰觸胸部", "碰觸屁股", "脫上衣至赤裸", "脫內褲至赤裸", "巴掌"];
    let selectedItems = new Set();
    let activeHardLimit = "";
    let passiveHardLimit = "";
    let allowanceLevels = {};
    const descriptions = ["絕對禁止(硬底線)", "不喜歡但可接受(軟底線)", "不太喜歡但可接受", "沒特別感覺", "很喜歡", "超級喜歡"];

    function setProgress(step) {
        const total = 6;
        const percent = (step / total) * 100;
        document.getElementById("progressBar").style.width = `${percent}%`;
        document.getElementById("progressBar").textContent = `步驟 ${step} / ${total}`;
    }

    function addItem() {
        let newItem = document.getElementById("newItem").value.trim();
        if (newItem && !items.includes(newItem)) {
            items.push(newItem);
            document.getElementById("newItem").value = "";
            renderOptions();
        }
    }

    function renderOptions() {
        let optionsDiv = document.getElementById("options");
        optionsDiv.innerHTML = "";
        items.forEach(item => {
            let div = document.createElement("div");
            div.className = "form-check";
            let checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.className = "form-check-input";
            checkbox.value = item;
            checkbox.id = `chk_${item}`;
            if (selectedItems.has(item)) checkbox.checked = true;
            checkbox.onchange = function() {
                if (this.checked) selectedItems.add(this.value);
                else selectedItems.delete(this.value);
            };
            let label = document.createElement("label");
            label.className = "form-check-label";
            label.htmlFor = `chk_${item}`;
            label.textContent = item;
            div.appendChild(checkbox);
            div.appendChild(label);
            optionsDiv.appendChild(div);
        });
    }

    function confirmIntro() {
        document.getElementById("pageIntro").classList.add("d-none");
        document.getElementById("page1").classList.remove("d-none");
        renderOptions();
        setProgress(2);
    }

    function confirmSelection() {
        if (selectedItems.size === 0) {
            alert("請選擇至少一項。");
            return;
        }
        document.getElementById("page1").classList.add("d-none");
        document.getElementById("activeLimits").classList.remove("d-none");
        setProgress(3);
    }

    function confirmActiveHardLimit() {
        activeHardLimit = document.getElementById("activeHardLimit").value;
        document.getElementById("activeLimits").classList.add("d-none");
        document.getElementById("page2Intro").classList.remove("d-none");
        setProgress(4);
    }

    function confirmPage2Intro() {
        document.getElementById("page2Intro").classList.add("d-none");
        document.getElementById("page2").classList.remove("d-none");
        renderAllowance();
        setProgress(5);
    }

    function renderAllowance() {
        let allowanceDiv = document.getElementById("allowance");
        allowanceDiv.innerHTML = "";
        selectedItems.forEach(item => {
            let container = document.createElement("div");
            container.className = "slider-container";
            let label = document.createElement("label");
            label.textContent = item;
            let slider = document.createElement("input");
            slider.type = "range";
            slider.min = 0;
            slider.max = 5;
            slider.step = 1;
            slider.value = 3;
            slider.dataset.item = item;
            slider.className = "form-range";
            slider.oninput = function() {
                updateSliderValue(this);
            };
            let span = document.createElement("span");
            span.textContent = descriptions[3];
            container.appendChild(label);
            container.appendChild(slider);
            container.appendChild(span);
            allowanceDiv.appendChild(container);
        });
    }

    function updateSliderValue(slider) {
        slider.nextElementSibling.textContent = descriptions[slider.value];
    }

    function confirmAllowance() {
        document.querySelectorAll("#allowance input").forEach(input => {
            allowanceLevels[input.dataset.item] = input.value;
        });
        document.getElementById("page2").classList.add("d-none");
        document.getElementById("passiveLimits").classList.remove("d-none");
        setProgress(6);
    }

    function confirmPassiveHardLimit() {
        passiveHardLimit = document.getElementById("passiveHardLimit").value;
        document.getElementById("passiveLimits").classList.add("d-none");
        document.getElementById("page3").classList.remove("d-none");
        showFinalResult();
    }

    function showFinalResult() {
        let resultText = `主動方的硬底線：${activeHardLimit}\n\n被動方的硬底線：${passiveHardLimit}\n\n允許程度：\n`;
        let rejectedItemsHtml = "";
        let hasRejectedItems = false;

        for (let item in allowanceLevels) {
            if (allowanceLevels[item] == "0") {
                rejectedItemsHtml += `<div class="rejected-item">${item} - 絕對禁止</div>`;
                hasRejectedItems = true;
            } else {
                resultText += `${item}: ${allowanceLevels[item]} (${descriptions[allowanceLevels[item]]})\n`;
            }
        }

        document.getElementById("finalResult").innerText = resultText;

        if (hasRejectedItems) {
            document.getElementById("rejectedTitle").classList.remove("d-none");
            document.getElementById("rejectedItems").innerHTML = rejectedItemsHtml;
        } else {
            document.getElementById("rejectedTitle").classList.add("d-none");
            document.getElementById("rejectedItems").innerHTML = "";
        }
    }
</script>
</body>
</html>
